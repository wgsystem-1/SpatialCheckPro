## 좌표가 0,0으로 저장되는 원인 파악 완료

FileGDB 오류 저장 시 객체 좌표가 (0, 0)으로 저장되는 **근본 원인**을 파악했습니다.

------

### **핵심 원인: 지오메트리 검수 시 좌표 미추출**

오류 검출 단계에서 `GeometryErrorDetail` 객체를 생성할 때 **X, Y 좌표를 설정하지 않아** 기본값 0.0으로 초기화되고 있습니다.

------

### **문제 발생 위치**

#### 1️⃣ **HighPerformanceGeometryValidator.cs:76-85**

```csharp
errorDetails.Add(new GeometryErrorDetail
{
    ObjectId = objectId.ToString(),
    ErrorType = "중복 지오메트리",
    ErrorValue = $"정확히 동일한 지오메트리 (그룹 크기: {group.Count})",
    ThresholdValue = coordinateTolerance > 0 ? $"좌표 허용오차 {coordinateTolerance}m" : "Exact match",
    DetailMessage = coordinateTolerance > 0
        ? $"OBJECTID {objectId}: 좌표 허용오차 {coordinateTolerance}m 이내 동일한 지오메트리"
        : $"OBJECTID {objectId}: 완전히 동일한 지오메트리"
    // ❌ X, Y 좌표 설정 누락!
});
```

#### 2️⃣ **HighPerformanceGeometryValidator.cs:124-131**

```csharp
errorDetails.Add(new GeometryErrorDetail
{
    ObjectId = overlap.ObjectId.ToString(),
    ErrorType = "겹침 지오메트리",
    ErrorValue = $"겹침 영역: {overlap.OverlapArea:F2}㎡",
    ThresholdValue = $"{tolerance}m",
    DetailMessage = $"OBJECTID {overlap.ObjectId}: 겹침 영역 {overlap.OverlapArea:F2}㎡ 검출"
    // ❌ X, Y 좌표 설정 누락!
});
```

#### 3️⃣ **GeometryValidationService.cs:202, 207, 212, 239**

```csharp
list.Add(new GeometryErrorDetail { 
    ObjectId = GetObjectId(f), 
    ErrorType = "기본검수", 
    DetailMessage = "NULL 지오메트리" 
    // ❌ X, Y 좌표 설정 누락!
});
```

------

### **데이터 흐름 추적**

```
1. 지오메트리 검수
   ├─ HighPerformanceGeometryValidator.cs
   └─ GeometryValidationService.cs
   └─ GeometryErrorDetail 생성 (X=0, Y=0) ❌

2. ValidationResult로 변환
   └─ GeometryValidationItem.ErrorDetails에 저장

3. QcError로 변환
   └─ ValidationResultConverter.cs:300-301
       X = errorDetail.X,  // 0이 전달됨 ❌
       Y = errorDetail.Y,  // 0이 전달됨 ❌

4. FileGDB에 저장
   └─ QcErrorDataService.cs:211
       if (qcError.X != 0 || qcError.Y != 0)  // 조건 불충족
       {
           // 좌표로 Point 생성 (실행되지 않음)
       }
   └─ QC_Errors_NoGeom 레이어에 저장 (좌표 없음)
```

------

### **의도된 좌표 추출 로직 (실행되지 않음)**

QcErrorDataService.cs에는 좌표 추출 로직이 **잘 구현**되어 있습니다:

#### **CreateSimplePoint() 메서드 (833-957줄)**

```csharp
// Point → 그대로 사용
// MultiPoint → 첫 번째 Point
// LineString → 첫 번째 정점
// Polygon → 외부링의 첫 번째 정점
// 기타 → 중심점 (Envelope)
```

하지만 이 로직은 `qcError.Geometry` 또는 `qcError.GeometryWKT`가 있을 때만 실행되며, **X, Y가 이미 0,0으로 설정된 경우에는 실행되지 않습니다**.

------

### **해결 방법**

#### **방법 1: 검수 단계에서 좌표 추출 (권장)**

`GeometryErrorDetail` 생성 시 지오메트리에서 좌표를 추출하여 설정

```csharp
// HighPerformanceGeometryValidator.cs 수정 예시
var envelope = new OSGeo.OGR.Envelope();
geometry.GetEnvelope(envelope);
double centerX = (envelope.MinX + envelope.MaxX) / 2.0;
double centerY = (envelope.MinY + envelope.MaxY) / 2.0;

errorDetails.Add(new GeometryErrorDetail
{
    ObjectId = objectId.ToString(),
    ErrorType = "중복 지오메트리",
    X = centerX,  // ✅ 좌표 설정
    Y = centerY,  // ✅ 좌표 설정
    GeometryWkt = wkt,  // WKT도 함께 저장
    ErrorValue = $"...",
    DetailMessage = $"..."
});
```

#### **방법 2: ValidationResultConverter에서 보완**

GeometryErrorDetail의 GeometryWKT에서 좌표를 재추출

```csharp
// ValidationResultConverter.cs:300-301 수정
X = ExtractXFromGeometry(errorDetail),
Y = ExtractYFromGeometry(errorDetail),
```

------

### **영향 범위**

**수정 필요 파일:**

1. `/home/user/SpatialCheckPro/SpatialCheckPro/Services/HighPerformanceGeometryValidator.cs:76-85` (중복 검수)
2. `/home/user/SpatialCheckPro/SpatialCheckPro/Services/HighPerformanceGeometryValidator.cs:124-131` (겹침 검수)
3. `/home/user/SpatialCheckPro/SpatialCheckPro.GUI/Services/GeometryValidationService.cs:202, 207, 212, 239` (기본 검수)
4. 기타 `GeometryErrorDetail`을 생성하는 모든 위치

------

### **현재 상태 요약**

✅ **좌표 추출 알고리즘은 올바르게 구현**되어 있음 (QcErrorDataService.cs)
❌ **검수 단계에서 좌표를 설정하지 않아** 알고리즘이 실행되지 않음
❌ **결과적으로 모든 지오메트리 오류가 (0, 0)으로 저장**됨